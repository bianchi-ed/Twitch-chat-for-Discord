"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class UserState {
    constructor(client) {
        this.client = client;
    }
    preLoad() {
        return Promise.resolve({ command: 'userstate' });
    }
    execute(message) {
        return new Promise((resolve) => {
            const tags = message.tags;
            const channelName = message.command.channel;
            if (!this.client.channels.has(channelName)) {
                const channel = this.client.channels.generateChannel(channelName);
                this.client.channels.addChannel(channel);
            }
            if (this.client.channels.get(channelName).users.has(tags['display-name'].toLowerCase())) {
                this.client.channels.get(channelName).users.updateUser(tags['display-name'].toLowerCase(), tags);
                return resolve();
            }
            const user = this.client.channels.get(channelName).users.generateUserFromTwitch(tags['display-name'].toLowerCase(), tags);
            user.channel = this.client.channels.get(channelName);
            this.client.channels.get(channelName).users.addUser(user);
            return resolve();
        });
    }
}
exports.default = UserState;
